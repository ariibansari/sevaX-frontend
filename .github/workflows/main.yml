name: Deploy to Deployment Branch

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to Deployment Branch
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Check if deployment branch exists
        run: |
          if git rev-parse --verify deployment >/dev/null 2>&1; then
            echo "Deployment branch exists."
          else
            echo "Deployment branch does not exist. Creating..."
            git checkout -b deployment
            git push origin deployment
          fi

      - name: Delete all files in deployment branch
        run: |
          git checkout deployment
          git rm -rf .
          git commit -m "Delete all files"
          git push origin deployment

      - name: Copy build folder to deployment branch
        run: |
          git checkout master -- build/
          git checkout deployment
          mv build/* .
          git add .
          git commit -m "Copy build folder to deployment branch"
          git push origin deployment
